<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" th:replace="~{fragments/layout :: view(~{::title}, ~{::article})}">

<head>
	<title>Giỏ hàng - ShopOMG</title>
</head>

<body>
	<article class="container py-4">
		<style>
			/* TikTok-style Cart Styling */
			.cart-container {
				max-width: 1200px;
				margin: 0 auto;
			}

			.cart-header {
				font-size: 24px;
				font-weight: 700;
				margin-bottom: 20px;
				color: #111;
			}

			.cart-item {
				background: #fff;
				border-radius: 12px;
				padding: 16px;
				margin-bottom: 12px;
				display: flex;
				gap: 16px;
				border: 1px solid #f0f0f0;
				transition: all 0.2s;
			}

			.cart-item:hover {
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
			}

			.cart-item-image {
				width: 100px;
				height: 100px;
				border-radius: 8px;
				object-fit: cover;
				background: #f8f8f8;
			}

			.cart-item-info {
				flex: 1;
				display: flex;
				flex-direction: column;
				gap: 8px;
			}

			.cart-item-name {
				font-size: 16px;
				font-weight: 600;
				color: #111;
				margin: 0;
			}

			.cart-item-variant {
				font-size: 13px;
				color: #666;
			}

			.cart-item-price {
				font-size: 18px;
				font-weight: 700;
				color: #ff424e;
			}

			.cart-item-actions {
				display: flex;
				align-items: center;
				gap: 12px;
				margin-top: auto;
			}

			.quantity-control {
				display: flex;
				align-items: center;
				border: 1px solid #e0e0e0;
				border-radius: 6px;
				overflow: hidden;
			}

			.quantity-btn {
				width: 32px;
				height: 32px;
				border: none;
				background: #f8f8f8;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				color: #666;
				transition: all 0.2s;
			}

			.quantity-btn:hover {
				background: #e8e8e8;
			}

			.quantity-btn:disabled {
				opacity: 0.3;
				cursor: not-allowed;
			}

			.quantity-display {
				min-width: 45px;
				text-align: center;
				font-weight: 600;
				font-size: 14px;
				padding: 0 8px;
			}

			.delete-btn {
				border: none;
				background: none;
				color: #999;
				cursor: pointer;
				padding: 8px;
				font-size: 18px;
				transition: color 0.2s;
			}

			.delete-btn:hover {
				color: #ff424e;
			}

			.cart-summary {
				background: #fff;
				border-radius: 12px;
				padding: 20px;
				border: 1px solid #f0f0f0;
				position: sticky;
				top: 20px;
			}

			.summary-row {
				display: flex;
				justify-content: space-between;
				margin-bottom: 12px;
				font-size: 15px;
			}

			.summary-total {
				font-size: 20px;
				font-weight: 700;
				color: #111;
				padding-top: 12px;
				border-top: 1px solid #f0f0f0;
				margin-top: 12px;
			}

			.checkout-btn {
				width: 100%;
				background: #ff424e;
				color: white;
				border: none;
				border-radius: 8px;
				padding: 14px;
				font-size: 16px;
				font-weight: 600;
				cursor: pointer;
				margin-top: 16px;
				transition: all 0.2s;
			}

			.checkout-btn:hover {
				background: #e03a45;
				transform: translateY(-1px);
			}

			.empty-cart {
				text-align: center;
				padding: 60px 20px;
			}

			.empty-cart-icon {
				font-size: 80px;
				color: #ddd;
				margin-bottom: 20px;
			}

			.empty-cart-text {
				font-size: 18px;
				color: #666;
				margin-bottom: 24px;
			}

			.shop-now-btn {
				display: inline-block;
				background: #111;
				color: white;
				padding: 12px 32px;
				border-radius: 8px;
				text-decoration: none;
				font-weight: 600;
				transition: all 0.2s;
			}

			.shop-now-btn:hover {
				background: #333;
				color: white;
			}

			.alert-custom {
				border-radius: 8px;
				border: none;
				padding: 12px 16px;
				margin-bottom: 16px;
			}

			@media (max-width: 768px) {
				.cart-item {
					flex-direction: column;
				}

				.cart-item-image {
					width: 100%;
					height: 200px;
				}
			}
		</style>

		<div class="cart-container">
			<!-- Success/Error Messages -->
			<div th:if="${successMessage}" class="alert alert-success alert-custom" role="alert">
				<i class="fas fa-check-circle"></i> <span th:text="${successMessage}"></span>
			</div>
			<div th:if="${errorMessage}" class="alert alert-danger alert-custom" role="alert">
				<i class="fas fa-exclamation-circle"></i> <span th:text="${errorMessage}"></span>
			</div>

			<h1 class="cart-header">
				Giỏ hàng
				<span th:if="${itemCount > 0}" th:text="'(' + ${itemCount} + ')'"></span>
			</h1>

			<!-- Empty Cart State -->
			<div th:if="${cartItems == null || cartItems.isEmpty()}" class="empty-cart">
				<div class="empty-cart-icon">
					<i class="fas fa-shopping-bag"></i>
				</div>
				<div class="empty-cart-text">Giỏ hàng của bạn đang trống</div>
				<a th:href="@{/products}" class="shop-now-btn">
					<i class="fas fa-shopping-cart"></i> Mua sắm ngay
				</a>
			</div>

			<!-- Cart with Items -->
			<div th:if="${cartItems != null && !cartItems.isEmpty()}" class="row">
				<div class="col-lg-8">
					<!-- Cart Items -->
					<div th:each="item : ${cartItems}" class="cart-item">
						<img th:src="${item.productVariant.product.image}" class="cart-item-image"
							onerror="this.src='https://placehold.co/100x100'">

						<div class="cart-item-info">
							<h3 class="cart-item-name" th:text="${item.productVariant.product.name}">Tên sản phẩm</h3>

							<div class="cart-item-variant">
								<span th:text="'Màu: ' + ${item.productVariant.color}"></span> ·
								<span th:text="'Size: ' + ${item.productVariant.size}"></span>
							</div>

							<div class="cart-item-price">
								<span th:if="${item.productVariant.product.discount > 0}">
									<span
										th:text="${#numbers.formatDecimal(item.productVariant.product.price * (100 - item.productVariant.product.discount) / 100, 0, 'COMMA', 0, 'POINT')} + 'đ'"></span>
								</span>
								<span th:unless="${item.productVariant.product.discount > 0}">
									<span
										th:text="${#numbers.formatDecimal(item.productVariant.product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"></span>
								</span>
							</div>

							<div class="cart-item-actions">
								<!-- Quantity Control -->
								<form th:action="@{'/cart/update/' + ${item.id}}" method="post"
									style="display: inline-block;">
									<div class="quantity-control">
										<button type="submit" name="quantity" th:value="${item.quantity - 1}"
											class="quantity-btn" th:disabled="${item.quantity <= 1}">
											<i class="fas fa-minus"></i>
										</button>
										<span class="quantity-display" th:text="${item.quantity}">1</span>
										<button type="submit" name="quantity" th:value="${item.quantity + 1}"
											class="quantity-btn">
											<i class="fas fa-plus"></i>
										</button>
									</div>
								</form>

								<!-- Delete Button -->
								<form th:action="@{'/cart/remove/' + ${item.id}}" method="post"
									style="display: inline-block;">
									<button type="submit" class="delete-btn"
										onclick="return confirm('Xóa sản phẩm này khỏi giỏ hàng?')">
										<i class="fas fa-trash-alt"></i>
									</button>
								</form>
							</div>
						</div>
					</div>
				</div>

				<!-- Cart Summary -->
				<div class="col-lg-4">
					<div class="cart-summary">
						<h3 style="font-size: 18px; font-weight: 700; margin-bottom: 16px;">Tóm tắt đơn hàng</h3>

						<div class="summary-row">
							<span>Tạm tính:</span>
							<span class="fw-bold"
								th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + 'đ'">0đ</span>
						</div>

						<div class="summary-row">
							<span>Phí vận chuyển:</span>
							<span class="text-success">Miễn phí</span>
						</div>

						<div class="summary-row summary-total">
							<span>Tổng cộng:</span>
							<span th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + 'đ'">0đ</span>
						</div>

						<a th:href="@{/checkout}" class="checkout-btn">
							Thanh toán
						</a>

						<a th:href="@{/products}"
							style="display: block; text-align: center; margin-top: 12px; color: #666; text-decoration: none; font-size: 14px;">
							<i class="fas fa-chevron-left"></i> Tiếp tục mua sắm
						</a>
					</div>
				</div>
			</div>
		</div>
	</article>
</body>

</html>