<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" th:replace="~{fragments/layout :: view(~{::title}, ~{::article})}">

<head>
    <title>Địa chỉ của tôi - ShopOMG</title>
    <style>
        /* Style for select with size attribute (scrollable list) */
        select#city[size],
        select#district[size] {
            height: auto !important;
            max-height: 300px;
            overflow-y: auto;
            padding: 0;
            position: absolute !important;
            z-index: 1050 !important;
            background: white;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }

        select#city[size] option,
        select#district[size] option {
            padding: 8px 12px;
        }

        /* Adjust modal positioning to ensure space for dropdown */
        .modal-dialog {
            margin-top: 2rem !important;
            margin-bottom: auto;
        }
    </style>

</head>

<body>
    <article class="container py-5">
        <div class="row">
            <div class="col-lg-3 mb-4">
                <div th:replace="~{fragments/account-sidebar :: sidebar('addresses')}"></div>
            </div>

            <div class="col-lg-9">
                <div class="card-box">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h5 class="fw-bold mb-1">Địa chỉ của tôi</h5>
                            <p class="text-muted small mb-0">Quản lý địa chỉ giao hàng</p>
                        </div>
                        <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#addressModal"
                            onclick="openAddModal()">
                            <i class="fas fa-plus me-2"></i>Thêm địa chỉ mới
                        </button>
                    </div>

                    <!-- Alert Messages -->
                    <div id="alertContainer"></div>

                    <!-- Address List -->
                    <div id="addressList" class="row g-3">
                        <!-- Addresses will be loaded here via AJAX -->
                        <div class="col-12 text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Đang tải...</span>
                            </div>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div id="emptyState" class="text-center py-5" style="display: none;">
                        <i class="fas fa-map-marker-alt fa-3x text-muted mb-3"></i>
                        <p class="text-muted">Bạn chưa có địa chỉ nào</p>
                        <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#addressModal"
                            onclick="openAddModal()">
                            Thêm địa chỉ đầu tiên
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Article tag continues to include modals and scripts -->

        <!-- Address Modal -->
        <div class="modal fade" id="addressModal" tabindex="-1" aria-labelledby="addressModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title fw-bold" id="addressModalLabel">Thêm địa chỉ mới</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addressForm">
                            <input type="hidden" id="addressId">

                            <div class="mb-3">
                                <label for="recipientName" class="form-label small fw-bold">Họ và tên người nhận <span
                                        class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="recipientName" placeholder="Nhập họ tên...">
                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="mb-3">
                                <label for="phone" class="form-label small fw-bold">Số điện thoại <span
                                        class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="phone" placeholder="Nhập số điện thoại...">
                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="city" class="form-label small fw-bold">Tỉnh/Thành phố <span
                                            class="text-danger">*</span></label>

                                    <select class="form-select" id="city">
                                        <option value="">Chọn Tỉnh/Thành phố</option>
                                    </select>

                                    <input type="text" class="form-control" id="city" placeholder="VD: Hà Nội">

                                    <div class="invalid-feedback"></div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="district" class="form-label small fw-bold">Quận/Huyện <span
                                            class="text-danger">*</span></label>

                                    <select class="form-select" id="district" disabled>
                                        <option value="">Chọn Quận/Huyện</option>
                                    </select>

                                    <input type="text" class="form-control" id="district" placeholder="VD: Cầu Giấy">

                                    <div class="invalid-feedback"></div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="detailAddress" class="form-label small fw-bold">Địa chỉ chi tiết <span
                                        class="text-danger">*</span></label>
                                <textarea class="form-control" id="detailAddress" rows="2"
                                    placeholder="Số nhà, tên đường..."></textarea>
                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="isDefault">
                                <label class="form-check-label" for="isDefault">
                                    Đặt làm địa chỉ mặc định
                                </label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="button" class="btn btn-dark" onclick="saveAddress()">
                            <span id="saveButtonText">Lưu địa chỉ</span>
                            <span id="saveButtonSpinner" class="spinner-border spinner-border-sm ms-2"
                                style="display: none;"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title fw-bold" id="deleteModalLabel">Xác nhận xóa</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p class="mb-0">Bạn có chắc chắn muốn xóa địa chỉ này?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Hủy</button>
                        <button type="button" class="btn btn-danger btn-sm" onclick="confirmDelete()">Xóa</button>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .address-card {
                border: 2px solid #e9ecef;
                border-radius: 8px;
                padding: 20px;
                transition: all 0.3s ease;
                position: relative;
            }

            .address-card:hover {
                border-color: #dee2e6;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            }

            .address-card.default {
                border-color: #198754;
                background: linear-gradient(135deg, #f8fff9 0%, #ffffff 100%);
            }

            .default-badge {
                position: absolute;
                top: 15px;
                right: 15px;
                background: #198754;
                color: white;
                padding: 4px 12px;
                border-radius: 20px;
                font-size: 11px;
                font-weight: 600;
                text-transform: uppercase;
            }

            .address-actions {
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid #e9ecef;
            }

            .address-actions .btn {
                font-size: 13px;
                padding: 6px 12px;
            }

            .card-box {
                background: white;
                border-radius: 12px;
                padding: 30px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            }
        </style>

        <script>
            let deleteAddressId = null;

            // Load addresses on page load
            document.addEventListener('DOMContentLoaded', function () {
                loadAddresses();
            });

            // Load all addresses
            function loadAddresses() {
                fetch('/api/addresses', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(result => {
                        if (result.success && result.data && result.data.length > 0) {
                            displayAddresses(result.data);
                        } else {
                            showEmptyState();
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showAlert('Không thể tải danh sách địa chỉ', 'danger');
                        showEmptyState();
                    });
            }

            // Display addresses
            function displayAddresses(addresses) {
                const container = document.getElementById('addressList');
                const emptyState = document.getElementById('emptyState');

                emptyState.style.display = 'none';

                container.innerHTML = addresses.map(addr => `
                <div class="col-md-6">
                    <div class="address-card ${addr.isDefault ? 'default' : ''}">
                        ${addr.isDefault ? '<span class="default-badge">Mặc định</span>' : ''}
                        
                        <div class="mb-2">
                            <strong class="d-block mb-1">${escapeHtml(addr.recipientName)}</strong>
                            <span class="text-muted small">${escapeHtml(addr.phone)}</span>
                        </div>
                        
                        <p class="text-muted small mb-0">
                            ${escapeHtml(addr.detailAddress)}<br>
                            ${escapeHtml(addr.district)}, ${escapeHtml(addr.city)}
                        </p>

                        <div class="address-actions">
                            ${!addr.isDefault ? `
                                <button class="btn btn-sm btn-outline-success me-2" onclick="setDefault(${addr.id})">
                                    <i class="fas fa-check me-1"></i>Đặt mặc định
                                </button>
                            ` : ''}
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="editAddress(${addr.id})">
                                <i class="fas fa-edit me-1"></i>Sửa
                            </button>
                            ${!addr.isDefault ? `
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteAddress(${addr.id})">
                                    <i class="fas fa-trash me-1"></i>Xóa
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            }

            // Show empty state
            function showEmptyState() {
                document.getElementById('addressList').innerHTML = '';
                document.getElementById('emptyState').style.display = 'block';
            }

            // Open add modal
            function openAddModal() {
                document.getElementById('addressModalLabel').textContent = 'Thêm địa chỉ mới';
                document.getElementById('addressForm').reset();
                document.getElementById('addressId').value = '';
                clearValidation();
            }

            // Edit address
            function editAddress(id) {
                fetch(`/api/addresses/${id}`)
                    .then(response => response.json())
                    .then(result => {
                        if (result.success) {
                            const addr = result.data;
                            document.getElementById('addressModalLabel').textContent = 'Chỉnh sửa địa chỉ';
                            document.getElementById('addressId').value = addr.id;
                            document.getElementById('recipientName').value = addr.recipientName;
                            document.getElementById('phone').value = addr.phone;
                            document.getElementById('city').value = addr.city;
                            document.getElementById('district').value = addr.district;
                            document.getElementById('detailAddress').value = addr.detailAddress;
                            document.getElementById('isDefault').checked = addr.isDefault;

                            clearValidation();
                            const modal = new bootstrap.Modal(document.getElementById('addressModal'));
                            modal.show();
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showAlert('Không thể tải thông tin địa chỉ', 'danger');
                    });
            }

            // Save address
            function saveAddress() {
                const id = document.getElementById('addressId').value;
                const data = {
                    recipientName: document.getElementById('recipientName').value.trim(),
                    phone: document.getElementById('phone').value.trim(),
                    city: document.getElementById('city').value.trim(),
                    district: document.getElementById('district').value.trim(),
                    detailAddress: document.getElementById('detailAddress').value.trim(),
                    isDefault: document.getElementById('isDefault').checked
                };

                clearValidation();
                setLoading(true);

                const url = id ? `/api/addresses/${id}` : '/api/addresses';
                const method = id ? 'PUT' : 'POST';

                fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                    .then(response => response.json())
                    .then(result => {
                        setLoading(false);
                        if (result.success) {
                            bootstrap.Modal.getInstance(document.getElementById('addressModal')).hide();
                            showAlert(result.message, 'success');
                            loadAddresses();
                        } else {
                            if (result.data && typeof result.data === 'object') {
                                showValidationErrors(result.data);
                            } else {
                                showAlert(result.message, 'danger');
                            }
                        }
                    })
                    .catch(error => {
                        setLoading(false);
                        console.error('Error:', error);
                        showAlert('Đã xảy ra lỗi khi lưu địa chỉ', 'danger');
                    });
            }

            // Set default address
            function setDefault(id) {
                fetch(`/api/addresses/${id}/set-default`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(result => {
                        if (result.success) {
                            showAlert(result.message, 'success');
                            loadAddresses();
                        } else {
                            showAlert(result.message, 'danger');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showAlert('Không thể đặt địa chỉ mặc định', 'danger');
                    });
            }

            // Delete address
            function deleteAddress(id) {
                deleteAddressId = id;
                new bootstrap.Modal(document.getElementById('deleteModal')).show();
            }

            // Confirm delete
            function confirmDelete() {
                if (!deleteAddressId) return;

                fetch(`/api/addresses/${deleteAddressId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(result => {
                        bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
                        if (result.success) {
                            showAlert(result.message, 'success');
                            loadAddresses();
                        } else {
                            showAlert(result.message, 'danger');
                        }
                        deleteAddressId = null;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showAlert('Không thể xóa địa chỉ', 'danger');
                        deleteAddressId = null;
                    });
            }

            // Show alert
            function showAlert(message, type) {
                const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `;
                document.getElementById('alertContainer').innerHTML = alertHtml;

                setTimeout(() => {
                    const alert = document.querySelector('.alert');
                    if (alert) {
                        alert.classList.remove('show');
                        setTimeout(() => alert.remove(), 150);
                    }
                }, 5000);
            }

            // Show validation errors
            function showValidationErrors(errors) {
                Object.keys(errors).forEach(field => {
                    const input = document.getElementById(field);
                    if (input) {
                        input.classList.add('is-invalid');
                        const feedback = input.nextElementSibling;
                        if (feedback && feedback.classList.contains('invalid-feedback')) {
                            feedback.textContent = errors[field];
                        }
                    }
                });
            }

            // Clear validation
            function clearValidation() {
                document.querySelectorAll('.is-invalid').forEach(el => {
                    el.classList.remove('is-invalid');
                });
                document.querySelectorAll('.invalid-feedback').forEach(el => {
                    el.textContent = '';
                });
            }

            // Set loading state
            function setLoading(loading) {
                document.getElementById('saveButtonText').style.display = loading ? 'none' : 'inline';
                document.getElementById('saveButtonSpinner').style.display = loading ? 'inline-block' : 'none';
            }

            // Escape HTML
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }


            // ========== PROVINCE AND DISTRICT DROPDOWN LOGIC ==========

            // Vietnam Provinces and Districts Data (2026) - All 63 Provinces
            const vietnamData = {
                "An Giang": ["Long Xuyên", "Châu Đốc", "An Phú", "Tân Châu", "Phú Tân", "Châu Phú", "Tịnh Biên", "Tri Tôn", "Châu Thành", "Chợ Mới", "Thoại Sơn"],
                "Bà Rịa - Vũng Tàu": ["Vũng Tàu", "Bà Rịa", "Châu Đức", "Xuyên Mộc", "Long Điền", "Đất Đỏ", "Côn Đảo", "Tân Thành"],
                "Bắc Giang": ["Bắc Giang", "Hiệp Hòa", "Lạng Giang", "Lục Nam", "Lục Ngạn", "Sơn Động", "Tân Yên", "Việt Yên", "Yên Dũng", "Yên Thế"],
                "Bắc Kạn": ["Bắc Kạn", "Ba Bể", "Bạch Thông", "Chợ Đồn", "Chợ Mới", "Na Rì", "Ngân Sơn", "Pác Nặm"],
                "Bạc Liêu": ["Bạc Liêu", "Giá Rai", "Hòa Bình", "Hồng Dân", "Phước Long", "Vĩnh Lợi", "Đông Hải"],
                "Bắc Ninh": ["Bắc Ninh", "Từ Sơn", "Thuận Thành", "Gia Bình", "Lương Tài", "Quế Võ", "Tiên Du", "Yên Phong"],
                "Bến Tre": ["Bến Tre", "Ba Tri", "Bình Đại", "Châu Thành", "Chợ Lách", "Giồng Trôm", "Mỏ Cày Bắc", "Mỏ Cày Nam", "Thạnh Phú"],
                "Bình Định": ["Quy Nhơn", "An Lão", "An Nhơn", "Hoài Ân", "Hoài Nhơn", "Phù Cát", "Phù Mỹ", "Tây Sơn", "Tuy Phước", "Vân Canh", "Vĩnh Thạnh"],
                "Bình Dương": ["Thủ Dầu Một", "Dĩ An", "Thuận An", "Bến Cát", "Tân Uyên", "Bàu Bàng", "Dầu Tiếng", "Phú Giáo", "Bắc Tân Uyên"],
                "Bình Phước": ["Đồng Xoài", "Phước Long", "Bình Long", "Bù Đăng", "Bù Đốp", "Chơn Thành", "Đồng Phú", "Hớn Quản", "Lộc Ninh", "Phú Riềng"],
                "Bình Thuận": ["Phan Thiết", "La Gi", "Bắc Bình", "Đức Linh", "Hàm Tân", "Hàm Thuận Bắc", "Hàm Thuận Nam", "Phú Quý", "Tánh Linh", "Tuy Phong"],
                "Cà Mau": ["Cà Mau", "Cái Nước", "Đầm Dơi", "Năm Căn", "Ngọc Hiển", "Phú Tân", "Thới Bình", "Trần Văn Thời", "U Minh"],
                "Cần Thơ": ["Ninh Kiều", "Ô Môn", "Bình Thuỷ", "Cái Răng", "Thốt Nốt", "Phong Điền", "Cờ Đỏ", "Vĩnh Thạnh", "Thới Lai"],
                "Cao Bằng": ["Cao Bằng", "Bảo Lạc", "Bảo Lâm", "Hà Quảng", "Hạ Lang", "Hòa An", "Nguyên Bình", "Phục Hòa", "Quảng Hòa", "Thạch An", "Thông Nông", "Trà Lĩnh", "Trùng Khánh"],
                "Đà Nẵng": ["Hải Châu", "Thanh Khê", "Sơn Trà", "Ngũ Hành Sơn", "Liên Chiểu", "Cẩm Lệ", "Hòa Vang", "Hoàng Sa"],
                "Đắk Lắk": ["Buôn Ma Thuột", "Buôn Hồ", "Cư Kuin", "Cư M'gar", "Ea H'leo", "Ea Kar", "Ea Súp", "Krông Ana", "Krông Bông", "Krông Búk", "Krông Năng", "Krông Pắc", "Lắk", "M'Đrắk"],
                "Đắk Nông": ["Gia Nghĩa", "Cư Jút", "Đắk Glong", "Đắk Mil", "Đắk R'Lấp", "Đắk Song", "Krông Nô", "Tuy Đức"],
                "Điện Biên": ["Điện Biên Phủ", "Mường Lay", "Điện Biên", "Điện Biên Đông", "Mường Ảng", "Mường Chà", "Mường Nhé", "Nậm Pồ", "Tủa Chùa", "Tuần Giáo"],
                "Đồng Nai": ["Biên Hòa", "Long Khánh", "Nhơn Trạch", "Vĩnh Cửu", "Trảng Bom", "Thống Nhất", "Cẩm Mỹ", "Long Thành", "Định Quán", "Tân Phú", "Xuân Lộc"],
                "Đồng Tháp": ["Cao Lãnh", "Sa Đéc", "Hồng Ngự", "Cao Lãnh", "Châu Thành", "Hồng Ngự", "Lai Vung", "Lấp Vò", "Tam Nông", "Tân Hồng", "Thanh Bình", "Tháp Mười"],
                "Gia Lai": ["Pleiku", "An Khê", "Ayun Pa", "Chư Păh", "Chư Prông", "Chư Pưh", "Chư Sê", "Đắk Đoa", "Đắk Pơ", "Đức Cơ", "Ia Grai", "Ia Pa", "Kbang", "Kông Chro", "Krông Pa", "Mang Yang", "Phú Thiện"],
                "Hà Giang": ["Hà Giang", "Bắc Mê", "Bắc Quang", "Đồng Văn", "Hoàng Su Phì", "Mèo Vạc", "Quản Bạ", "Quảng Bình", "Vị Xuyên", "Xín Mần", "Yên Minh"],
                "Hà Nam": ["Phủ Lý", "Bình Lục", "Duy Tiên", "Kim Bảng", "Lý Nhân", "Thanh Liêm"],
                "Hà Nội": ["Ba Đình", "Hoàn Kiếm", "Tây Hồ", "Long Biên", "Cầu Giấy", "Đống Đa", "Hai Bà Trưng", "Hoàng Mai", "Thanh Xuân", "Nam Từ Liêm", "Bắc Từ Liêm", "Hà Đông", "Sơn Tây", "Ba Vì", "Chương Mỹ", "Đan Phượng", "Đông Anh", "Gia Lâm", "Hoài Đức", "Mê Linh", "Mỹ Đức", "Phú Xuyên", "Phúc Thọ", "Quốc Oai", "Sóc Sơn", "Thạch Thất", "Thanh Oai", "Thanh Trì", "Thường Tín", "Ứng Hòa"],
                "Hà Tĩnh": ["Hà Tĩnh", "Hồng Lĩnh", "Cẩm Xuyên", "Can Lộc", "Đức Thọ", "Hương Khê", "Hương Sơn", "Kỳ Anh", "Lộc Hà", "Nghi Xuân", "Thạch Hà", "Vũ Quang"],
                "Hải Dương": ["Hải Dương", "Chí Linh", "Bình Giang", "Cẩm Giàng", "Gia Lộc", "Kim Thành", "Kinh Môn", "Nam Sách", "Ninh Giang", "Thanh Hà", "Thanh Miện", "Tứ Kỳ"],
                "Hải Phòng": ["Hồng Bàng", "Ngô Quyền", "Lê Chân", "Hải An", "Kiến An", "Đồ Sơn", "Dương Kinh", "An Dương", "An Lão", "Bạch Long Vĩ", "Cát Hải", "Kiến Thụy", "Thủy Nguyên", "Tiên Lãng", "Vĩnh Bảo"],
                "Hậu Giang": ["Vị Thanh", "Ngã Bảy", "Châu Thành", "Châu Thành A", "Long Mỹ", "Phụng Hiệp", "Vị Thủy"],
                "Hòa Bình": ["Hòa Bình", "Cao Phong", "Đà Bắc", "Kim Bôi", "Kỳ Sơn", "Lạc Sơn", "Lạc Thủy", "Lương Sơn", "Mai Châu", "Tân Lạc", "Yên Thủy"],
                "Hưng Yên": ["Hưng Yên", "Ân Thi", "Khoái Châu", "Kim Động", "Mỹ Hào", "Phù Cừ", "Tiên Lữ", "Văn Giang", "Văn Lâm", "Yên Mỹ"],
                "Khánh Hòa": ["Nha Trang", "Cam Ranh", "Ninh Hòa", "Vạn Ninh", "Diên Khánh", "Khánh Vĩnh", "Khánh Sơn", "Cam Lâm", "Trường Sa"],
                "Kiên Giang": ["Rạch Giá", "Hà Tiên", "Phú Quốc", "An Biên", "An Minh", "Châu Thành", "Giang Thành", "Giồng Riềng", "Gò Quao", "Hòn Đất", "Kiên Hải", "Kiên Lương", "Tân Hiệp", "U Minh Thượng", "Vĩnh Thuận"],
                "Kon Tum": ["Kon Tum", "Đắk Glei", "Đắk Hà", "Đắk Tô", "Ia H' Drai", "Kon Plông", "Kon Rẫy", "Ngọc Hồi", "Sa Thầy", "Tu Mơ Rông"],
                "Lai Châu": ["Lai Châu", "Mường Tè", "Nậm Nhùn", "Phong Thổ", "Sìn Hồ", "Tam Đường", "Tân Uyên", "Than Uyên"],
                "Lâm Đồng": ["Đà Lạt", "Bảo Lộc", "Đơn Dương", "Đức Trọng", "Lạc Dương", "Lâm Hà", "Di Linh", "Bảo Lâm", "Cát Tiên", "Đạ Huoai", "Đạ Tẻh", "Đam Rông"],
                "Lạng Sơn": ["Lạng Sơn", "Bắc Sơn", "Bình Gia", "Cao Lộc", "Chi Lăng", "Đình Lập", "Hữu Lũng", "Lộc Bình", "Trang Định", "Văn Lãng", "Văn Quan"],
                "Lào Cai": ["Lào Cai", "Sa Pa", "Bảo Thắng", "Bảo Yên", "Bát Xát", "Mường Khương", "Si Ma Cai", "Văn Bàn", "Bắc Hà"],
                "Long An": ["Tân An", "Kiến Tường", "Bến Lức", "Cần Đước", "Cần Giuộc", "Châu Thành", "Đức Hòa", "Đức Huệ", "Mộc Hóa", "Tân Hưng", "Tân Thạnh", "Tân Trụ", "Thạnh Hóa", "Thủ Thừa", "Vĩnh Hưng"],
                "Nam Định": ["Nam Định", "Giao Thủy", "Hải Hậu", "Mỹ Lộc", "Nam Trực", "Nghĩa Hưng", "Trực Ninh", "Vụ Bản", "Xuân Trường", "Ý Yên"],
                "Nghệ An": ["Vinh", "Cửa Lò", "Thái Hòa", "Anh Sơn", "Con Cuông", "Diễn Châu", "Đô Lương", "Hưng Nguyên", "Kỳ Sơn", "Nam Đàn", "Nghi Lộc", "Nghĩa Đàn", "Quế Phong", "Quỳ Châu", "Quỳ Hợp", "Quỳnh Lưu", "Tân Kỳ", "Thanh Chương", "Tương Dương", "Yên Thành"],
                "Ninh Bình": ["Ninh Bình", "Tam Điệp", "Gia Viễn", "Hoa Lư", "Kim Sơn", "Nho Quan", "Yên Khánh", "Yên Mô"],
                "Ninh Thuận": ["Phan Rang-Tháp Chàm", "Bác Ái", "Ninh Hải", "Ninh Phước", "Ninh Sơn", "Thuận Bắc", "Thuận Nam"],
                "Phú Thọ": ["Việt Trì", "Phú Thọ", "Cẩm Khê", "Đoan Hùng", "Hạ Hòa", "Lâm Thao", "Phù Ninh", "Tam Nông", "Tân Sơn", "Thanh Ba", "Thanh Sơn", "Thanh Thủy", "Yên Lập"],
                "Phú Yên": ["Tuy Hòa", "Sông Cầu", "Đông Hòa", "Phú Hòa", "Sơn Hòa", "Sông Hinh", "Tây Hòa", "Tuy An", "Đồng Xuân"],
                "Quảng Bình": ["Đồng Hới", "Ba Đồn", "Bố Trạch", "Lệ Thủy", "Minh Hóa", "Quảng Ninh", "Quảng Trạch", "Tuyên Hóa"],
                "Quảng Nam": ["Tam Kỳ", "Hội An", "Bắc Trà My", "Đại Lộc", "Điện Bàn", "Đông Giang", "Duy Xuyên", "Hiệp Đức", "Nam Giang", "Nam Trà My", "Núi Thành", "Phú Ninh", "Phước Sơn", "Quế Sơn", "Tây Giang", "Thăng Bình", "Tiên Phước"],
                "Quảng Ngãi": ["Quảng Ngãi", "Ba Tơ", "Bình Sơn", "Đức Phổ", "Lý Sơn", "Minh Long", "Mộ Đức", "Nghĩa Hành", "Sơn Hà", "Sơn Tây", "Sơn Tịnh", "Tây Trà", "Trà Bồng", "Tư Nghĩa"],
                "Quảng Ninh": ["Hạ Long", "Móng Cái", "Cẩm Phả", "Uông Bí", "Đông Triều", "Quảng Yên", "Ba Chẽ", "Bình Liêu", "Cô Tô", "Đầm Hà", "Hải Hà", "Hoành Bồ", "Tiên Yên", "Vân Đồn"],
                "Quảng Trị": ["Đông Hà", "Quảng Trị", "Cam Lộ", "Gio Linh", "Hải Lăng", "Hướng Hóa", "Triệu Phong", "Vĩnh Linh", "Đa Krông", "Cồn Cỏ"],
                "Sóc Trăng": ["Sóc Trăng", "Vĩnh Châu", "Ngã Năm", "Châu Thành", "Cù Lao Dung", "Kế Sách", "Long Phú", "Mỹ Tú", "Mỹ Xuyên", "Thạnh Trị", "Trần Đề"],
                "Sơn La": ["Sơn La", "Mộc Châu", "Bắc Yên", "Mai Sơn", "Mường La", "Phù Yên", "Quỳnh Nhai", "Sông Mã", "Sốp Cộp", "Thuận Châu", "Vân Hồ", "Yên Châu"],
                "Tây Ninh": ["Tây Ninh", "Hòa Thành", "Bến Cầu", "Châu Thành", "Dương Minh Châu", "Gò Dầu", "Tân Biên", "Tân Châu", "Trảng Bàng"],
                "Thái Bình": ["Thái Bình", "Đông Hưng", "Hưng Hà", "Kiến Xương", "Quỳnh Phụ", "Thái Thụy", "Tiền Hải", "Vũ Thư"],
                "Thái Nguyên": ["Thái Nguyên", "Sông Công", "Phổ Yên", "Phú Bình", "Đại Từ", "Định Hóa", "Đồng Hỷ", "Phú Lương", "Võ Nhai"],
                "Thanh Hóa": ["Thanh Hóa", "Bỉm Sơn", "Sầm Sơn", "Bá Thước", "Cẩm Thủy", "Đông Sơn", "Hà Trung", "Hậu Lộc", "Hoằng Hóa", "Lang Chánh", "Mường Lát", "Nga Sơn", "Ngọc Lặc", "Như Thanh", "Như Xuân", "Nông Cống", "Quan Hóa", "Quan Sơn", "Quảng Xương", "Thạch Thành", "Thiệu Hóa", "Thọ Xuân", "Thường Xuân", "Tĩnh Gia", "Triệu Sơn", "Vĩnh Lộc", "Yên Định"],
                "Thừa Thiên Huế": ["Huế", "Phong Điền", "Phú Lộc", "Phú Vang", "Quảng Điền", "A Lưới", "Hương Thủy", "Hương Trà", "Nam Đông"],
                "Tiền Giang": ["Mỹ Tho", "Gò Công", "Cai Lậy", "Cái Bè", "Châu Thành", "Chợ Gạo", "Gò Công Đông", "Gò Công Tây", "Tân Phú Đông", "Tân Phước"],
                "TP. Hồ Chí Minh": ["Quận 1", "Quận 2", "Quận 3", "Quận 4", "Quận 5", "Quận 6", "Quận 7", "Quận 8", "Quận 9", "Quận 10", "Quận 11", "Quận 12", "Bình Thạnh", "Gò Vấp", "Phú Nhuận", "Tân Bình", "Tân Phú", "Thủ Đức", "Bình Tân", "Bình Chánh", "Cần Giờ", "Củ Chi", "Hóc Môn", "Nhà Bè"],
                "Trà Vinh": ["Trà Vinh", "Càng Long", "Cầu Kè", "Cầu Ngang", "Châu Thành", "Duyên Hải", "Tiểu Cần", "Trà Cú"],
                "Tuyên Quang": ["Tuyên Quang", "Chiêm Hóa", "Hàm Yên", "Lâm Bình", "Na Hang", "Sơn Dương", "Yên Sơn"],
                "Vĩnh Long": ["Vĩnh Long", "Bình Minh", "Bình Tân", "Long Hồ", "Mang Thít", "Tam Bình", "Trà Ôn", "Vũng Liêm"],
                "Vĩnh Phúc": ["Vĩnh Yên", "Phúc Yên", "Bình Xuyên", "Lập Thạch", "Sông Lô", "Tam Dương", "Tam Đảo", "Vĩnh Tường", "Yên Lạc"],
                "Yên Bái": ["Yên Bái", "Nghĩa Lộ", "Lục Yên", "Mù Cang Chải", "Trạm Tấu", "Trấn Yên", "Văn Chấn", "Văn Yên", "Yên Bình"]
            };

            // Populate provinces on page load
            function initializeProvinceDropdown() {
                const citySelect = document.getElementById('city');
                const provinces = Object.keys(vietnamData).sort();

                provinces.forEach(province => {
                    const option = document.createElement('option');
                    option.value = province;
                    option.textContent = province;
                    citySelect.appendChild(option);
                });
            }

            // Handle province selection change
            document.getElementById('city').addEventListener('change', function () {
                const districtSelect = document.getElementById('district');
                const selectedProvince = this.value;

                // Clear previous districts
                districtSelect.innerHTML = '<option value="">Chọn Quận/Huyện</option>';

                if (selectedProvince) {
                    // Enable district dropdown
                    districtSelect.disabled = false;

                    // Populate districts for selected province
                    const districts = vietnamData[selectedProvince];
                    if (districts) {
                        districts.forEach(district => {
                            const option = document.createElement('option');
                            option.value = district;
                            option.textContent = district;
                            districtSelect.appendChild(option);
                        });
                    }

                    // Clear any validation error
                    this.classList.remove('is-invalid');
                    const feedback = this.nextElementSibling;
                    if (feedback && feedback.classList.contains('invalid-feedback')) {
                        feedback.textContent = '';
                    }
                } else {
                    // Disable district dropdown if no province selected
                    districtSelect.disabled = true;
                }
            });

            // Handle district selection validation
            document.getElementById('district').addEventListener('click', function () {
                const citySelect = document.getElementById('city');

                if (!citySelect.value) {
                    // Show validation message if province not selected
                    citySelect.classList.add('is-invalid');
                    const feedback = citySelect.nextElementSibling;
                    if (feedback && feedback.classList.contains('invalid-feedback')) {
                        feedback.textContent = 'ShopOMG! xin thông báo: Vui lòng chọn địa chỉ Tỉnh/Thành phố của bạn trước. Xin cảm ơn';
                    }

                    // Focus on province dropdown
                    citySelect.focus();
                }
            });

            // Limit dropdown height by using size attribute
            function setupDropdownLimit(selectElement) {
                let isExpanded = false;

                selectElement.addEventListener('mousedown', function (e) {
                    if (!isExpanded) {
                        // Expand to show 10 items
                        this.setAttribute('size', '10');
                        isExpanded = true;
                        e.preventDefault();
                        this.focus();
                    }
                });

                selectElement.addEventListener('blur', function () {
                    // Collapse back to normal
                    this.removeAttribute('size');
                    isExpanded = false;
                });

                selectElement.addEventListener('change', function () {
                    // Collapse after selection
                    this.removeAttribute('size');
                    isExpanded = false;
                });

                // Handle clicking outside
                document.addEventListener('click', function (e) {
                    if (e.target !== selectElement && isExpanded) {
                        selectElement.removeAttribute('size');
                        isExpanded = false;
                    }
                });
            }

            // Initialize on page load
            document.addEventListener('DOMContentLoaded', function () {
                initializeProvinceDropdown();

                const citySelect = document.getElementById('city');
                const districtSelect = document.getElementById('district');

                if (citySelect) setupDropdownLimit(citySelect);
                if (districtSelect) setupDropdownLimit(districtSelect);
            });

        </script>
    </article>
</body>

</html>